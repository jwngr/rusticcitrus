!function(){"use strict";function e(e){return e.split("").reduce(function(e,t){return e*l[t]},1)}function t(e){e.transition({scale:.8,duration:25}).transition({scale:1,duration:25})}function s(e){e.animate({transform:"s0.8"},25),window.setTimeout(function(){e.animate({transform:"s1.0"},25)},25)}var n,i,o,r,u,a=30,d=80,h=80,c=150,m=900,l={A:2,B:3,C:5,D:7,E:11,F:13,G:17,H:19,I:23,J:29,K:31,L:37,M:41,N:43,O:47,P:53,Q:59,R:61,S:67,T:71,U:73,V:79,W:83,X:89,Y:97,Z:101},f=function(){function e(e){this.word=e,this.image=null,this.isFound=!1}return e}(),p=function(){function e(e,t,s,n,i){this.letter=e,this.currentIndex=t,this.guessedIndex=null,this.unguessedYCoord=i,this.letterImage=s,this.round=n}return e.prototype.isGuessed=function(){return null!=this.guessedIndex},e.prototype.guess=function(e,t){if(RC.Music.soundEffectsOn&&t){var n=new Audio("/resources/sounds/soundEffects/guess.mp3");n.volume=1,n.play()}this.guessedIndex=this.round.getNumGuessedLetters();var i=this.letterImage;if(e){s(i);var o=this;window.setTimeout(function(){i.animate({x:o.round.getAvailableLetterXCoord(o.guessedIndex),y:o.unguessedYCoord-c},250)},50)}else i.animate({x:this.round.getAvailableLetterXCoord(this.guessedIndex),y:this.unguessedYCoord-c},250)},e.prototype.unguess=function(e,t){if(RC.Music.soundEffectsOn&&t){var n=new Audio("/resources/sounds/soundEffects/guess.mp3");n.volume=1,n.play()}var i=this.round.getNumGuessedLetters();if(this.guessedIndex+1!=i)for(var o=this.round.letters.length,r=0;o>r;r++){var u=this.round.letters[r];if(u.isGuessed()&&u.guessedIndex>this.guessedIndex){u.guessedIndex-=1;var a=u.letterImage;a.animate({x:this.round.getAvailableLetterXCoord(u.guessedIndex)},100)}}this.guessedIndex=null;var a=this.letterImage;if(e){s(a);var d=this;window.setTimeout(function(){a.animate({x:d.round.getAvailableLetterXCoord(d.currentIndex),y:a.attr("y")+(d.unguessedYCoord-a.attr("y"))},250)},50)}else a.animate({x:this.round.getAvailableLetterXCoord(this.currentIndex),y:this.unguessedYCoord},250)},e.prototype.onClick=function(e){e.isGuessed()?e.unguess(!0,!0):e.guess(!0,!0)},e}(),g=function(){function s(e,t,s,n){RC.debug&&(RC.assert("object"==typeof e,"game is not an object"),RC.assert("singlePlayer"===e.gameType||"multiplayer"===e.gameType,"gameType has unexpecte value"),RC.assert("number"==typeof t,"numLetters is not an object"),RC.assert("number"==typeof s,"secondsRemaining is not a number")),this.game=e,this.numLetters=t,this.secondsRemaining=s,this.subsetWords=[],this.letters=[],this.previousGuess=[],this.successfullyCompleted=!1,void 0===n?(this.foundWords=[],this.isPaused=!1,this.isDone=!1):(RC.debug&&(RC.assert("string"==typeof n.word,"word is not a string"),RC.assert("object"==typeof n.foundWords,"foundWords is not an object"),RC.assert("boolean"==typeof n.startRoundPaused,"startRoundPaused is not a boolean"),RC.assert("boolean"==typeof n.startRoundDone,"startRoundDone is not a boolean")),this.word=n.word,this.foundWords=n.foundWords,this.isPaused=n.startRoundPaused,this.isDone=n.startRoundDone),this.initializeRound()}return s.prototype.initializeRound=function(){for(;void 0===RC.wordList;);switch(void 0===this.word?this.generateWord():this.wordHash=e(this.word),window.innerWidth>1366?(i=34,n=34,o=15,r=40):(i=28,n=28,o=6,r=25),void 0===RC.Achievements.dictionary&&(RC.debug?RC.Achievements.deleteFile_DEBUG(RC.Achievements.load):RC.Achievements.load()),this.numLetters){case 5:u=95;break;case 6:u=60;break;case 7:u=36}this.generateSubsetWords(),this.drawSubsetWords(),this.drawLetters(),this.drawMiscellaneous(),this.isDone?($("#gameBoard").show(),this.endRound(!0)):this.isPaused?this.pause():($("#gameBoard").show(),$("#availableLettersPaper, .gameBoardButton, #guessedLettersPlank").show(),this.initializeGameBoardEventListeners(),"multiplayer"===this.game.gameType&&($("#pauseGameButton").hide(),$("#endRoundButton").hide()),this.startTimer())},s.prototype.initializeGameBoardEventListeners=function(){var e=this;$("#pauseGameButton").on("click",function(){e.pause()}),$("#submitButton").on("click",function(){e.submitGuess()}),$("#shuffleButton").on("click",function(){e.shuffleLetters()}),$("#lastButton").on("click",function(){e.setPreviousGuess()}),$("#endRoundButton").on("click",function(){e.successfullyCompleted?$("#endRoundMenu .gameOverlayMenuTitle").text("Skip to next round?"):$("#endRoundMenu .gameOverlayMenuTitle").text("End game?"),$("#availableLettersPaper, .gameBoardButton, #guessedLettersPlank").not("#pauseGameButton").fadeOut(100,function(){$("#endRoundMenu").fadeIn()}),e.stopTimer(),e.disposeGameBoardEventListeners(),e.isPaused=!0});for(var t=0;t<this.numLetters;t++)!function(e){e.letterImage.click(function(){e.onClick(e)})}(this.letters[t]);$("body").focus();var s=this;$("body").on("keydown",function(e){if(13==e.which)s.submitGuess(!0);else if(8==e.which){for(var t=s.getNumGuessedLetters(),n=s.game.numLetters,i=0;n>i;i++){var o=s.letters[i];o.guessedIndex==t-1&&o.unguess(!0,!0)}e.preventDefault()}else if(32==e.which)s.shuffleLetters(!0);else if(38==e.which)s.setPreviousGuess(!0);else if(27==e.which)s.pause(!0);else if(e.which>=65&&e.which<=90)for(var i=0;i<s.game.numLetters;i++){var o=s.letters[i];if(!o.isGuessed()&&o.letter==String.fromCharCode(e.which).toUpperCase()){o.guess(!0,!0);break}}})},s.prototype.disposeGameBoardEventListeners=function(){$("#pauseGameButton").off("click"),$("#submitButton").off("click"),$("#shuffleButton").off("click"),$("#lastButton").off("click"),$("#endRoundButton").off("click"),$(".gameBoardButton").unbind();for(var e=0;e<this.numLetters;e++){var t=this.letters[e].letterImage;if(t.events)for(;t.events.length;){var s=t.events.pop();s.unbind()}}$("body").off("keydown"),$("body").on("keydown",function(e){8==e.which&&e.preventDefault()})},s.prototype.startTimer=function(){var e=this;this.timer=window.setInterval(function(){e.updateTime()},1e3)},s.prototype.stopTimer=function(){window.clearTimeout(this.timer)},s.prototype.generateWord=function(){this.word="";for(var e=Object.keys(RC.wordList),t=e.length;this.word.length!=this.numLetters||-1!=$.inArray(this.word,this.game.pastRoundWords);){var s=e[Math.floor(Math.random()*t)],n=RC.wordList[s].split(","),i=n[Math.floor(Math.random()*n.length)].split("|");this.word=s+i[0],this.wordHash=parseInt(i[1])}this.game.pastRoundWords.push(this.word)},s.prototype.generateSubsetWords=function(){for(var e=[],t=0;t<this.numLetters;++t)for(var s=0;s<this.numLetters;++s)for(var n=0;n<this.numLetters;++n)if(t!=s&&s!=n&&t!=n){var i=this.word[t]+this.word[s]+this.word[n];-1==$.inArray(i,e)&&e.push(i)}for(var o=[],r=e.length,t=0;r>t;++t){var u=e[t],a=RC.wordList[u];if(void 0!==a){a=a.split(",");for(var d=a.length,s=0;d>s;++s){var h=a[s].split("|"),c=u+h[0],m=parseInt(h[1]);c.length<=this.numLetters&&0==this.wordHash%m&&o.push(c)}}}o.sort(function(e,t){var s=e.length-t.length;return 0!=s?s:t>e?-1:1});for(var l=o.length,t=0;l>t;++t)this.subsetWords.push(new f(o[t]))},s.prototype.drawSubsetWords=function(){var e,t,s=a,u=a;o-=1;do o+=1,e=Math.floor((window.innerHeight+o-2*a)/(i+o)),t=window.innerHeight-i*e-o*(e-1)-2*a;while(t>11&&25>o);for(var d=0,h=0,c=this.subsetWords.length,m=this.game.papers.subsetWords,l=0;c>l;l++){var f=this.subsetWords[l],p=s,g=$.inArray(f.word,this.foundWords)>-1,v=f.word.length;if(g)for(var R=0;v>R;R++){var w=f.word[R];m.image("/resources/images/letterSquares/letterSquare"+w+".png",s,u,n,i),s+=n+1}else{var y=m.image("/resources/images/letterSquares/"+v+"LetterBlankWord.png",s,u,v*(n+1),i);f.image=y,s+=(n+1)*v}g&&(f.isFound=!0,v==this.numLetters&&(this.successfullyCompleted=!0,$("#endRoundButton").removeClass("endGameButton").addClass("nextRoundButton"))),d=s+50,h+=1,h==e?(s+=r,u=a,h=0):(s=p,u+=i+o)}window.innerWidth+25-d>900&&$("#subsetWordsMask").hide(),this.game.papers.subsetWords.setSize(d,window.innerHeight)},s.prototype.getAvailableLetterXCoord=function(e){return m-a-35-d*(this.numLetters-e)-u*(this.numLetters-1-e)},s.prototype.drawLetters=function(){for(var e=window.innerHeight-360,t=0;t<this.numLetters;t++){var s=this.game.papers.availableLetters.image("/resources/images/letterOranges/letterOrange"+this.word[t]+".png",0,e,d,h);$(s.node).css("opacity",0);var n=new p(this.word[t],t,s,this,e);this.letters.push(n)}this.shuffleLetters(!1,!0);for(var t=0;t<this.numLetters;t++){var i=this.letters[t],o=Raphael.animation([{opacity:0},{opacity:1,x:i.letterImage.attr("x")-50}],200);i.letterImage.animate(o.delay(50))}},s.prototype.drawMiscellaneous=function(){this.isDone?$("#round").text(this.game.numRoundsCompleted):$("#round").text(this.game.numRoundsCompleted+1),$("#score").text(this.game.score);var e=Math.floor(this.secondsRemaining/60),t=this.secondsRemaining%60;t>=10?$("#timeRemaining").text(e.toString()+":"+t.toString()):$("#timeRemaining").text(e.toString()+":0"+t.toString())},s.prototype.pause=function(e){e&&t($("#pauseGameButton")),$("#gameBoard").fadeOut(100,function(){$("#pauseMenu").fadeIn()}),this.disposeGameBoardEventListeners(),this.stopTimer(),this.isPaused=!0,RC.Music.musicOn&&RC.Music.gameBoardMusic.pause()},s.prototype.resume=function(e){$("#"+e).fadeOut(function(){"pauseMenu"==e?$("#gameBoard").fadeIn(100):"endRoundMenu"==e&&$("#availableLettersPaper, .gameBoardButton, #guessedLettersPlank").not("#pauseGameButton").fadeIn(100)}),this.initializeGameBoardEventListeners(),this.startTimer(),this.isPaused=!1,RC.Music.musicOn&&RC.Music.gameBoardMusic.play()},s.prototype.getNumGuessedLetters=function(){for(var e=0,t=0;t<this.numLetters;t++)this.letters[t].isGuessed()&&e++;return e},s.prototype.updateScore=function(e){var t=e.length,s=10*t;this.game.score+=s,this.animateScoreIncrease(s);for(var n=!0,i=!0,o=this.subsetWords.length,r=0;o>r;r++){var u=this.subsetWords[r];if(0==u.isFound&&(i=!1,u.word.length==t)){n=!1;break}}if(n){var a=100;this.game.score+=a,this.animateScoreIncrease(a,750)}if(i){var d=10*this.secondsRemaining;this.game.score+=d,this.animateScoreIncrease(d,1500),this.endRound()}var h=[],c=RC.Achievements.dictionary[this.numLetters.toString()];this.game.score>=5e3&&(h.push({achievement:c[0],expectedName:"High Scorer"}),this.game.score>=1e4&&(h.push({achievement:c[1],expectedName:"Allstar"}),this.game.score>=5e4&&(h.push({achievement:c[2],expectedName:"Champion"}),this.game.score>=1e5&&(h.push({achievement:c[3],expectedName:"El Presidente"}),this.game.score>=25e4&&h.push({achievement:c[4],expectedName:"World Class"}))))),RC.Achievements.unlock(h);var m=this.game.score,s=m-parseInt($("#score").text()),l=s>1e3?10:s>500?5:1,f=window.setInterval(function(){RC.currentGame||window.clearInterval(f),$("#score").text(parseInt($("#score").text())+l),parseInt($("#score").text())>m&&($("#score").text(m),window.clearInterval(f))},1)},s.prototype.animateScoreIncrease=function(e,t){window.setTimeout(function(){if(RC.currentGame){var t=$("<p id='scoreIncreaseContainer'>+"+e+"</p>");$("#scoreContainer").after(t),$("#score");var s=$("#score").offset();t.offset({top:s.top+5,left:s.left+$("#score").width()/2-20}),t.transition({x:"25px",y:"25px",opacity:0,duration:1500}),window.setTimeout(function(){t.remove()},1500)}},t)},s.prototype.updateTime=function(){this.secondsRemaining-=1;var e=Math.floor(this.secondsRemaining/60),t=this.secondsRemaining%60;if(t>=10)$("#timeRemaining").text(e.toString()+":"+t.toString());else{if(0==e)if(0==t){if(RC.Music.soundEffectsOn){var s=new Audio("/resources/sounds/soundEffects/roundOver.mp3");s.volume=.2,s.play()}}else if(RC.Music.soundEffectsOn){var s=new Audio("/resources/sounds/soundEffects/timeRunningOut.mp3");s.volume=.3,s.play()}$("#timeRemaining").text(e.toString()+":0"+t.toString())}0==e&&0==t&&this.endRound()},s.prototype.endRound=function(e){this.stopTimer(),this.disposeGameBoardEventListeners(),$("#availableLettersPaper, .gameBoardButton, #guessedLettersPlank, #endRoundMenu").not("#pauseGameButton").fadeOut(100),$("#endRoundButton").removeClass("nextRoundButton").addClass("endGameButton"),this.isDone=!0,this.isPaused=!0;for(var t=this.game.papers.subsetWords,s=this.subsetWords.length,o=0;s>o;o++){var r=this.subsetWords[o];if(!r.isFound){for(var u=r.word.length,a=r.image.attr("x"),d=r.image.attr("y"),h=0;u>h;h++)t.image("/resources/images/letterSquares/missedLetterSquare"+r.word[h]+".png",a,d,n,i),a=a+n+1;r.image.remove(),r.image=null}}if("multiplayer"===this.game.gameType)this.game.end();else if(this.foundWords.length==this.subsetWords.length)e||(this.game.numRoundsCompleted+=1,this.game.numConsecutivePerfectRounds+=1,this.checkForEndOfRoundAchievements()),$("#nextRoundMenu > p").text("Perfect!"),$("#nextRoundMenu").fadeIn();else if(this.successfullyCompleted)e||(this.game.numRoundsCompleted+=1,this.game.numConsecutivePerfectRounds=0,this.checkForEndOfRoundAchievements()),$("#nextRoundMenu > p").text("You got it!"),$("#nextRoundMenu").fadeIn();else{e||(this.game.numConsecutivePerfectRounds=0);var c=!(e||RC.licenseInformation.isTrial);this.game.end(c,function(){RC.licenseInformation.isTrial?($("#gameOverMenuNoHighScore").show(),$("#gameOverMenuHighScore").hide(),$("#gameOverMenu").fadeIn()):($("#gameOverMenuNoHighScore").show(),$("#gameOverMenuHighScore").hide(),$("#gameOverMenu").fadeIn())})}},s.prototype.checkForEndOfRoundAchievements=function(){var e=[],t=RC.Achievements.dictionary[this.numLetters.toString()],s=this.game.numRoundsCompleted;if(s>=5&&(e.push({achievement:t[5],expectedName:"Just A Spark"}),s>=10&&(e.push({achievement:t[6],expectedName:"Heating Up"}),s>=15&&(e.push({achievement:t[7],expectedName:"On Fire"}),s>=25&&(e.push({achievement:t[8],expectedName:"Inferno"}),s>=50&&e.push({achievement:t[9],expectedName:"Supernova"}))))),this.foundWords.length==this.subsetWords.length){var n=120-this.secondsRemaining;100>=n&&(e.push({achievement:t[10],expectedName:"Lazy Stroll"}),80>=n&&(e.push({achievement:t[11],expectedName:"Pep In Your Step"}),60>=n&&(e.push({achievement:t[12],expectedName:"Major Hustle"}),45>=n&&(e.push({achievement:t[13],expectedName:"Speed Demon"}),30>=n&&e.push({achievement:t[14],expectedName:"Seriously Slow Down"})))))}t=RC.Achievements.dictionary.Miscellaneous,this.foundWords.length==this.subsetWords.length&&(5==this.numLetters?e.push({achievement:t[0],expectedName:"High Five"}):6==this.numLetters?e.push({achievement:t[1],expectedName:"Double Sixes"}):7==this.numLetters&&e.push({achievement:t[2],expectedName:"Lucky Seven"}),2==this.game.numConsecutivePerfectRounds?e.push({achievement:t[3],expectedName:"Double Perfecto"}):3==this.game.numConsecutivePerfectRounds&&e.push({achievement:t[4],expectedName:"Triple Perfecto"})),1==this.foundWords.length&&e.push({achievement:t[5],expectedName:"Going Solo"}),RC.Achievements.unlock(e)},s.prototype.clearGuess=function(){for(var e=[],t=0;t<this.numLetters;t++){var s=this.letters[t];s.isGuessed()&&e.push(s.currentIndex)}e.sort();for(var t=0;t<this.numLetters;t++){var s=this.letters[t];s.isGuessed()&&(s.currentIndex=e[s.guessedIndex])}for(var t=0;t<this.numLetters;t++){var s=this.letters[t];s.isGuessed()&&s.unguess()}},s.prototype.submitGuess=function(e){if(e&&t($("#submitButton")),0!=this.getNumGuessedLetters()){this.previousGuess=[];for(var s="";s.length!=this.getNumGuessedLetters();)for(var o=0;o<this.numLetters;o++){var r=this.letters[o];if(r.guessedIndex==s.length){s+=r.letter,this.previousGuess.push(r);break}}for(var u=[],a=this.subsetWords.length,o=0;a>o;o++){var d=this.subsetWords[o];if(0==d.isFound&&d.word==s){d.isFound=!0,this.foundWords.push(d.word);for(var h=d.image.attr("x"),c=d.image.attr("y"),m=this.game.papers.subsetWords,l=d.word.length,f=0;l>f;f++)m.image("/resources/images/letterSquares/letterSquare"+d.word[f]+".png",h,c,n,i),h=h+n+1;if(d.image.remove(),d.image=null,this.updateScore(s),this.game.numWordsFound+=1,30==this.foundWords.length&&u.push({achievement:RC.Achievements.dictionary.Miscellaneous[7],expectedName:"Bushel of Words"}),this.successfullyCompleted||l!=this.numLetters||(this.successfullyCompleted=!0,$("#endRoundButton").removeClass("endGameButton").addClass("nextRoundButton"),this.secondsRemaining<=3&&u.push({achievement:RC.Achievements.dictionary.Miscellaneous[6],expectedName:"Buzzer Beater"})),RC.Music.soundEffectsOn){var p=new Audio("/resources/sounds/soundEffects/correctGuess.mp3");p.volume=.1,p.play()}$.inArray("RUSTIC",this.foundWords)>-1&&$.inArray("CITRUS",this.foundWords)>-1&&u.push({achievement:RC.Achievements.dictionary.Miscellaneous[8],expectedName:"So Meta"});break}if(o==a-1&&RC.Music.soundEffectsOn){var p=new Audio("/resources/sounds/soundEffects/incorrectGuess.mp3");p.volume=.8,p.play()}}this.clearGuess(),RC.Achievements.unlock(u)}},s.prototype.setPreviousGuess=function(e){if(RC.Music.soundEffectsOn){var s=new Audio("/resources/sounds/soundEffects/guess.mp3");s.volume=1,s.play()}e&&t($("#lastButton")),this.clearGuess();for(var n=this.previousGuess.length,i=0;n>i;i++)this.previousGuess[i].guess(!1,!1)},s.prototype.isShuffled=function(){for(var e=!0,t="",s=[],n=0;n<this.numLetters;n++){var i=this.letters[n],o=i.currentIndex;o!=n&&(e=!1),s.push(o),t+=i.letter}if(e)return!1;for(var r=this.subsetWords.length,n=r-1;n>=0;n--){var u=this.subsetWords[n],a=u.word.length;if(a!=this.numLetters)break;if(u.word==t)return!1}return!0},s.prototype.shuffleLetters=function(e,s){if(RC.Music.soundEffectsOn&&!s){var n=new Audio("/resources/sounds/soundEffects/shuffle.mp3");n.volume=.2,n.play()}e&&t($("#shuffleButton"));do this.letters.sort(function(){return.5-Math.random()});while(!this.isShuffled());for(var i=0;i<this.numLetters;i++){var o=this.letters[i];if(o.currentIndex=i,!o.isGuessed()){var r=o.letterImage;s?r.attr("x",this.getAvailableLetterXCoord(o.currentIndex)+50):r.animate({x:this.getAvailableLetterXCoord(o.currentIndex)},100)}}},s}();WinJS.Namespace.defineWithParent(RC,"Classes",{SubsetWord:f,RoundLetter:p,Round:g})}();